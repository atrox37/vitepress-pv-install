## 通道以及通道点位配置

![1](.\docs\public\images\Setting\Configuration\channel\1.png)
### 基础概念
在物联网系统中，终端设备、采集网关以及云平台之间需要通过各种通信方式实现数据采集、遥控指令下发、设备状态监测等功能。为了实现标准化的设备接入及数据管理，平台基于工业物联网（IIoT）与电力自动化（SCADA）领域的成熟经验，引入了**通道（Channel）、通道点位（Channel Point）、通讯协议（Protocol）、四遥类型（遥测/遥信/遥控/遥调）及 通道映射（Mapping）**等概念。
这些概念构成了系统实现设备与云端间通信的基础逻辑，是理解设备接入流程、点位配置、数据格式和网关行为的重要参考。

#### 通道
##### 概念定义
通道是设备（或网关)与平台之间建立通信所使用的**逻辑链路**，包含了完成数据读写所需的一整套必要配置信息。
简单来说，通道定义了：

- 使用哪种协议与设备通信；
- 如何连接设备；
- 使用什么参数进行数据读写；
- 如何保持通信和进行错误重试。
通道是设备通信的基础，是所有点位读写操作的前提。

##### 通道包含的配置项
**Basic Information：**

  - **id**：通道的唯一标识。
  - **name**：通道的名称。
  - **description**：对通道的描述。
  - **protocol**：通道所遵循的协议，目前有`modbus_tcp`、`modbus_rtu`、`di_do` 协议。
  - **enabled**：通道是否可用。

**Parameters**：
根据 **protocol** 动态切换，常见参数说明：

- **modbus_tcp**
    - **host**：主机地址（IP/域名）。示例：192.168.1.10、http://baidu.com。
    - **port**：端口（默认 502）。范围：1-65535。
    - **connect_timeout_ms**：连接超时（正整数，毫秒）。
    - **read_timeout_ms**：读取超时（正整数，毫秒）。
- **modbus_rtu**
    - **device**：串口设备路径（如 /dev/ttyS0、COM3）
    - **baud_rate**：波特率（典型值：9600/19200/38400/115200）
    - **data_bits**：数据位（常用 8）
    - **stop_bits**：停止位（1 或 2）
    - **parity**：校验位（N=无、E=偶校验、O=奇校验）
    - **connect_timeout_ms**：连接超时（正整数，毫秒）
    - **read_timeout_ms**：读取超时（正整数，毫秒）
    - **retry_interval_ms**：读写失败后的重试间隔（正整数，毫秒）

**Running Status：**

- **connected**：通道是否连接（Connected/Disconnected）。
- **running**：运行状态（Running/Stop）。
- **last_update**：最后更新时间。
- **error_count**：错误数量。
- **last_error**：最后的错误信息。

**Point Counts：**

- **telemetry**：遥测点位数量。
- **signal**：遥信点位数量。
- **control**：遥控点位数量。
- **adjustment**：遥调点位数量。

##### 通道的作用
通道与设备通信的全过程都离不开通道的作用，包括：

- 平台或网关如何建立连接（串口 / TCP / RTU / 以太网等）；
- 如何从设备读取数据；
- 如何向设备写入或下发指令；
- 如何监控通信状态并进行异常处理。
通俗理解为：
通道 = 设备通信所需的“线路 + 协议 + 参数”。

#### 四遥

##### 概念定义

在工业自动化、电力系统以及物联网设备管理中，业务数据通常按“四遥”分类进行组织与管理。“四遥”是 SCADA（监控与数据采集系统）的经典数据模型，被广泛应用于 IIoT 平台、电力自动化、水务、暖通、能源管理系统等领域。
四遥分类用于明确“点位的性质与用途”，帮助用户理解每一个点位表示什么、能做什么、如何被采集或下发。
##### 遥测
 ###### 概念定义

遥测指设备上传的连续量、模拟量、可度量的实时数值。
 一般以数值类型呈现（整数或浮点数）。
###### 常见示例

- 温度（℃）
- 湿度（%RH）
- 电压（V）、电流（A）
- 功率（kW）、功率因数
- 压力（kPa）、液位（%）
- 流量、风速、转速
- 能耗读数（电、气、水等）

###### 特点

- 多为读操作；
- 数值会随设备运行实时变化；
- 通常需要配置采集周期。
   在平台中的使用
   遥测点用于趋势分析、报表统计、能耗监测、运行优化等业务场景。

##### 遥信

###### 概念定义

遥信指设备状态、开关量、枚举量等离散状态信息。
一般仅有两种状态（0/1），也可能扩展为少量枚举值。
###### 常见示例

- 运行/停止
- 合闸/分闸
- 启动/未启动
- 报警/正常
- 故障/正常
- 门开/关
- 某继电器吸合/释放

###### 特点

- 多为读操作；
- 适用于监控设备状态；
- 变化事件可触发告警。
  在平台中的使用
  遥信点广泛用于报警管理、事件监测、状态记录等场景。

##### 遥控
 ###### 概念定义

遥控指平台向设备下发的动作命令，用于改变设备的运行状态。
属于“写操作”。
###### 常见示例

- 启动/停止设备
- 打开/关闭阀门
- 合闸/分闸
- 启动排风、排水、加热设备
- 重启控制器
- 切换模式

###### 特点

- 需要具备权限控制；
- 常要求二次确认或安全校验；
- 多为开关型命令（0/1）。
  在平台中的使用
  遥控适用于智能化操作、远程管理、自动化控制策略执行等场景。

---
##### 遥调

###### 概念定义

遥调是远程参数调整，用于对设备运行参数进行设定。
 同样属于“写操作”，但与遥控不同，遥调作用于设备内部的“设定值”。

###### 常见示例

- 温度设定值
- 压力上限/下限设定
- 频率设定（Hz）
- 电压、电流保护阈值
- 费率参数（电表）
- PID 控制参数（P/I/D）

###### 特点

- 参数型写操作，而非开关动作；
- 对设备运行性能影响较大；
- 通常需要校验范围与类型。
  在平台中的使用
  遥调常与自动化控制策略结合，用于调节环境、优化能源效率等。

#### 通道点位

##### 概念定义

通道点位是指设备在指定协议下的实际数据点（真实寄存器地址或信号地址）。点位是数据采集及指令下发的最小操作单元。
例如，在 Modbus 协议中：

- 电压可能位于地址 40001
- 电流可能位于地址 40002
- 设备启停可能位于 00001（开关量）
  这些寄存器或标志位即为“通道点位”。

##### 点位分类
平台将点位按照工业自动化领域的“四遥标准”进行分类：

| 类型 | 名称       | 说明                                         |
| ---- | ---------- | -------------------------------------------- |
| 遥测 | Telemetry  | 连续量/模拟量（如温度、电压）                |
| 遥信 | Signal     | 状态量/开关量（如开/关、报警）               |
| 遥控 | Control    | 平台向设备下发的控制命令（如启停）           |
| 遥调 | Adjustment | 平台下发的设备参数设定值（如频率、电压设定） |

点位类型决定了它属于读取类（遥测/遥信）还是写入类（遥控/遥调）。

>注意：对于通道类型为di_do类型的通道，其通道点位类型只有遥信（Signal）和遥控（Control），因为其值只有0和1。

##### 字段解释

每个通道点位通常包含以下信息：

- `point_id`：点位唯一编号（正整数）。
- `signal_name`：业务信号名称。
- `value`：当前点位的数据。
- `scale/offset`：数据缩放与偏移，用于将原始值转换为业务值。
- `unit`：点位所对应的数据单位。
- `reverse`：值是否要反转（常用于开关量）。

> **注意：对于遥信（Signal）和遥控（Control）类型的点位，其点位信息无需`scale`、`offset`、`unit`字段。**

#### 通道点位映射
##### 概念定义
由于不同设备厂商的寄存器地址、协议结构不尽相同，需要将“设备实际点位”映射到平台统一的数据模型。
 通道映射用于实现：

- 原始点位 → 统一格式
- 协议地址 → 平台标准地址
- 多寄存器合并、缩放、单位转换等处理
平台通过映射规则，将设备底层寄存器数据转换为平台统一的数据结构，为历史数据、告警、公式计算提供标准输入。

##### 字段解释
遵循不同协议的通道，其点位的映射不同：

**modbus_rtu/modbus_tcp**：

- `point_id`：点位唯一编号（正整数）
- `slave_id`：Modbus 等协议中的从机号
- `data_type`：数据类型，有int16、uint16、int32、uint32、float32、int64、uint64、float64、bool。
- `byte_order`：字节序，如AB、BA、ABCD、CDAB等。
- `function_code`：寄存器功能码，分别对应不同的功能寄存器
  - `01`：读取线圈（Coils）状态，用于获取可读写的开关量输出（1bit）。
  - `02`：读取离散输入（Discrete Inputs）状态，用于获取只读的开关量输入（1bit）。
  - `03`：读取保持寄存器（Holding Registers），用于获取可读写的16位寄存器数据（如设定值/参数）。
  - `04`：读取输入寄存器（Input Registers），用于获取只读的16位寄存器数据（如测量值/采集量）。
  - `05`：写单个线圈（Single Coil），用于写入一个开关量输出（1bit）。
  - `06`：写单个保持寄存器（Single Holding Register），用于写入一个16位寄存器值。
  - `15`：写多个线圈（Multiple Coils），用于批量写入多个开关量输出（多个1bit）。
  - `16`：写多个保持寄存器（Multiple Holding Registers），用于批量写入多个16位寄存器值。
- `register_address`：寄存器地址，设备实际存放数据的位置，一般为1-65535。
- `bit_position`：真实值所在的位置，适用于开关量，取值范围为1-15

**di_do**：

* `point_id`：点位唯一编号（正整数）
* `gpio_number`： Linux 给 GPIO line 的“全局编号“，使用户用一个数字就能指到某条 IO 线，不等同于物理针脚/芯片管脚。

**这些内容决定平台如何将设备原始数据正确解析为可使用的业务数据。**

### 配置操作
#### 查询通道

![2](.\docs\public\images\Setting\Configuration\channel\2.png)

1. 支持针对通道进行筛选，筛选条件有：
- **protocol**：通道协议类型（如 modbus_tcp、modbus_rtu、di_do）。
- **enabled**：是否启用（Enabled、Disabled）。
- **connected**：是否已连接（Connected、Disconnected）。
2. 选择好筛选条件后，点击`Search`按钮，进行筛选搜索。
3. 点击`Reload`按钮，重置筛选。

#### 查看通道详情及编辑

![3](.\docs\public\images\Setting\Configuration\channel\3.png)

1. 点击所要查看的通道行的`Operation`列中的`Detail`按钮，打开通道详情弹窗。

![4](.\docs\public\images\Setting\Configuration\channel\4.png)

2. 点击`Edit`按钮进入通道信息的编辑模式。

![5](.\docs\public\images\Setting\Configuration\channel\5.png)

3. 填入所要修改的数据值，字段规则参考基础概念中对通道字段的解释。
4. 点击`Submit`按钮进行提交。
5. 点击`Cancel Edit`按钮取消编辑。

#### 新增通道

![6](.\docs\public\images\Setting\Configuration\channel\6.png)

2. 点击`New Channel`按钮，打开添加弹出框。

![7](.\docs\public\images\Setting\Configuration\channel\7.png)

3. 通过`Protocol`选择框进行通道协议的切换。填入正确的参数信息，字段规则参考详情页字段介绍。
4. 点击`Submit`按钮，提交新增的通道。
5. 点击`Cancel Add`按钮，取消新增。

#### 对已有通道的enable状态进行调整

![8](.\docs\public\images\Setting\Configuration\channel\8.png)

1. 点击对应通道行的`Enable`列下面的滑块进行调整。向左设置为`Enabled`，向右设置为`Disabled`。

#### 删除已有的通道
![9](.\docs\public\images\Setting\Configuration\channel\9.png)

1. 点击想要删除的通道行`Operation`列的`Delete`按钮进行删除。

![10](.\docs\public\images\Setting\Configuration\channel\10.png)

2. 点击`Confirm`按钮确认删除。
3. 点击`Cancel`按钮取消删除。

#### 通道点位配置

![11](.\docs\public\images\Setting\Configuration\channel\11.png)
![12](.\docs\public\images\Setting\Configuration\channel\12.png)

1. 通过点击想要查看的通道行**Operation**列的**Points**按钮，打开点位弹框。

2. 点位类型的切换标签按钮，分别有**telemetry**、**signal**、**control**、**adjustment**，对应通道点位的四遥分类。点击展示对应类型下的点位。
3. 视图模式切换：视图分为**Points（点位）**和**Mappings（点位映射）**，点击对应的按钮进行视图切换。
4. 点击**Batch Publish**按钮可进行批量数值下发操作。
5. 点击**Operation**列的**Publish**按钮可进行单个点位的数值下发操作。
6. 点击**Export**按钮把当前tab页下面的表格数据以**.csv**的格式进行导出。
7. 点击**Edit**按钮进入对点位的编辑模式。
8. 点击**Cancel**按钮关闭弹框。
9. 点位筛选框，可以手动输入进行点位名称的模糊搜索或者通过下拉框对点位名称的选择进行精准搜索。

![13](.\docs\public\images\Setting\Configuration\channel\13.png)
通过视图切换滑块到**mappings**后，页面解析如下：

10. 点击tab切换点位的类型，对点位映射的查看。
11. 点击**Export**按钮，以**.csv**的格式导出当前点位类型中的表格数据。
12. 点击**Edit**按钮进入对点位映射的编辑模式。
13. 点击**Cancel**按钮关闭弹框。

##### 下发点位的值

下发点位的值有两种方式：**批量下发**和**单点下发**。

###### 单点下发



![14](.\docs\public\images\Setting\Configuration\channel\14.png)

![15](.\docs\public\images\Setting\Configuration\channel\15.png)

![16](.\docs\public\images\Setting\Configuration\channel\16.png)

1. 点击所要下发值的点位行的**Publish**按钮，打开单点下发值弹框。

2. 在Value的输入框中进行下发值的输入（对于**telemetry**、**adjustment**而言，下发值为数字；对于**signal**、**control**而言，下发值为0或者1）。
3. 点击**Submit**按钮进行值的单点下发提交。
4. 点击**Cancel**按钮取消对值的单点下发。
5. 下发成功，值发生改变。

###### 批量下发

![17](.\docs\public\images\Setting\Configuration\channel\17.png)

![18](.\docs\public\images\Setting\Configuration\channel\18.png)

![19](.\docs\public\images\Setting\Configuration\channel\19.png)

1. 点击所要批量下发的点位类型页面的**Batch Publish**按钮，进行批量下发操作（只针对当前点位类型）。

2. 在表格中的**Publish**中对下发值进行填入（对于**telemetry**、**adjustment**而言，下发值为数字；对于**signal**、**control**而言，下发值为0或者1）。
3. 点击**Submit Publish**按钮，进行批量值下发的提交。
4. 点击**Cancel Publish**按钮，取消批量值下发的操作。
5. 下发成功，值发生改变。

##### 批量修改点位

![20](.\docs\public\images\Setting\Configuration\channel\20.png)

1. 点击点位视图中的Edit按钮，进入对所有点位的编辑模式。

![21](.\docs\public\images\Setting\Configuration\channel\21.png)

2. 针对修改过程中的增删改操作，可以通过筛选条件进行筛选（只针对与单个点位类型表格）：

- **modified**：对进行了实际修改的点位进行筛选，修改后的点位记录左侧显示为蓝色，修改后的数据标为蓝色。
  ![22](.\docs\public\images\Setting\Configuration\channel\22.png)
- **added**：对通过新增操作添加的点位进行筛选，新增的点位记录左侧以及数据显示为绿色。
  ![23](.\docs\public\images\Setting\Configuration\channel\23.png)
- **deleted**：对通过删除操作删除的点位进行筛选，删除的点位记录的左侧以及数据显示为红色。
  ![24](.\docs\public\images\Setting\Configuration\channel\24.png)
- **invalid**：对通过增加、修改后存在问题的点位进行筛选，存在问题的点位记录的左侧显示为橙色，背景显示为暗红色。
  ![25](.\docs\public\images\Setting\Configuration\channel\25.png)
  点位配置规则：
- `point_id`：正整数（必填，不可重复）
- `signal_name`：字符串，禁止包含空格（必填）
- `scale`：数值（必填）
- `offset`：数字（必填）
- `unit`：字符串（选填）
- `reverse`：true/false（必填）

> **注意：对于点位的修改遵循批量修改原则，即先在本地进行修改，在全部修改完毕并且没有错误出现的前提下，点击Submit按钮才能真正地修改通道 点位中地点位数据，对于后续的mappings的修改也是如此。**

###### 通过文件导入点位信息

![26](.\docs\public\images\Setting\Configuration\channel\26.png)

1. 点击**Import**按钮，选择**.csv格式**的点位文件进行导入，根据不同的点位类型，对文件格式内容有以下要求：

* telemetry/adjustment

  - 期望表头**(必须包含以下表头信息，其他额外表头也可以存在，但是并不会起作用)**：

    `point_id,signal_name,scale,offset,unit,reverse`

  - 字段说明：遵循点位配置规则要求。

  - 格式截图：

    <img src=".\docs\public\images\Setting\Configuration\channel\27.png" alt="27" style="zoom: 33%;" />

* signal/control

  * 期望表头(必须包含以下表头信息，其他额外表头也可以存在，但是并不会起作用)：

    `point_id,point_name,reverse`

  * 字段说明：遵循点位配置规则要求。

  * 格式截图：
  
    <img src=".\docs\public\images\Setting\Configuration\channel\27(1).png" alt="27(1)" style="zoom: 33%;" />

>**注意：**
>
>- **所有导入的记录将作为“新增”渲染（绿色高亮），即使存在校验错误也会导入，但会标记为“invalid”以便你在界面修正。**
>- **每次导入会整体覆盖当前的点位信息。**

###### 新增点位

![28](.\docs\public\images\Setting\Configuration\channel\28.png)

1. 点击**新增图标**按钮，在对应点位类型表格中的第一行出现可填写的点位行记录。
2. 对可填写行进行内容填写，遵循配置规则。
3. 点击**√图标**按钮，完成对填写的点位的本地新增。
4. 点击**×图标**按钮，取消对于填写点位的本地新增。
5. 确认新增后点位记录的样式如图所示，可以通过”**added**“筛选条件进行筛选。

> **注意：在新增过程中，每个tab中最多只支持对一个点位的新增，即只会出现一个新增行，只有在点击确认图标或者取消图标之后，才可以再次进行新增行的添加。如果已有新增行没有实现确认或者取消操作，再次点击新增按钮，不会有新增行的出现。**

###### 删除点位

![29](.\docs\public\images\Setting\Configuration\channel\29.png)

1. 点击所要删除行的**删除图标**按钮，实现点位的本地删除。
2. 本地删除后的点位记录的样式如图所示，可以通过”**delected**“筛选条件进行筛选。
3. 可以点击删除行后的复原图标按钮进行复原，此时会撤销本地的删除操作。

###### 修改点位

![30](.\docs\public\images\Setting\Configuration\channel\30.png)

1. 点击所要修改的点位的**修改图标**按钮对点位进行修改。
2. 依照点位的配置规则，对点位进行修改，对已有点位进行修改的时候，不可以修改id。
3. 如果是对新增的点位进行修改，则是可以修改id的。
4. 点击**确认图标**按钮，本地保存对点位的修改。
5. 点击**取消图标**按钮，取消本次对点位的修改。
6. 本地修改后的点位记录样式如图所示，其会把修改的数据使用蓝色进行标记。可以通过“**modified**”筛选条件进行筛选。

###### 提交所有修改

![31](.\docs\public\images\Setting\Configuration\channel\31.png)

1. 在提交时必须保证修改的点位数据没有问题，错误提示会出现在错误数据下方。
2. 点击**Submit**按钮进行批量修改提交。
3. 点击**Cancel Edit**按钮，退出修改，点位表展示初始值。

> **注意：无需手动进行查询，直接点击Submit按钮之后，若有问题可以直接进行跳转。**

##### 导出点位CSV文件

![32](.\docs\public\images\Setting\Configuration\channel\32.png)

点击**Export**按钮，可以实现对当前tab下面的表格数据进行导出，导出格式为**.csv**，文件名称为：**通道的名称+tab名称（telemetry/signal/control/adjustment）+当前时间戳**。

#### 通道点位映射配置

##### 批量修改点位的映射

![33](.\docs\public\images\Setting\Configuration\channel\33.png)

1. 在**mappings**视图中，点击**Edit**按钮，进入到点位映射的修改中。

![34](.\docs\public\images\Setting\Configuration\channel\34.png)

1. 针对修改过程中的修改操作，可以通过筛选条件进行筛选：

- **modified**：对进行了实际修改的点位进行筛选，修改后的点位记录左侧显示为蓝色，修改后的数据标为蓝色。

![35](.\docs\public\images\Setting\Configuration\channel\35.png)

- **invalid**：对通过增加、修改后存在问题的点位进行筛选，存在问题的点位记录的左侧显示为橙色，背景显示为暗红色。

![36](.\docs\public\images\Setting\Configuration\channel\36.png)

点位映射配置规则（不同的通道类型其点位的映射信息不同）：

**modbus_rtu/modbus_tcp:**

- **Function Code**取决于当前的点位类型（四遥）：
  - **telemetry**：3、4
  - **signal**：1、2、3、4
  - **control**：5、15、6、16
  - **adjustment**：6、16
- **Data Type**：
  - **telemetry**：int16、uint16、int32、float32、uint32、int64、uint64、float64
  - **signal**：同 telemetry，此外允许 bool
  - **control**：同 telemetry，此外允许 bool
  - **adjustment**：同 telemetry
- **Byte Order**的可选项由数据长度决定：
  - **bool**：无限制
  - **16 位**：AB、BA
  - **32 位**：AB、BA、ABCD、DCBA、BADC、CDAB
  - **64 位**：在 32 位基础上增加 ABCDEFGH、HGFEDCBA、BADCFEHG、GHEFCDAB
- **Bit Position**：**仅在“dataType为bool并且functionCode为3/4”或“16 位”整数类型下可编辑（0-15），其他类型固定为 0。**

###### 通过文件导入点位映射信息

![37](.\docs\public\images\Setting\Configuration\channel\37.png)

1. 点击**Import**按钮，选择csv格式的点位文件进行导入，根据不同的通道类型，对文件格式内容有不同的要求要求：

* **modbus_rtu/modbus_tcp**

  - 期望表头：

    `point_id,slave_id,function_code,register_address,data_type,byte_order,bit_position`

  - 字段说明：遵循点位配置规则要求。

  - 格式截图：

    <img src=".\docs\public\images\Setting\Configuration\channel\38.png" alt="38" style="zoom:50%;" />

* **di_do**

  * 期望表头：

    `point_id,gpio_number`

  - 字段说明：遵循点位配置规则要求。

  - 格式截图：
  
    <img src=".\docs\public\images\Setting\Configuration\channel\38(1).png" alt="38(1)" style="zoom:50%;" />

>**注意：**
>
>* **通过文件导入的形式进行实例点位映射修改的时候，其会整体覆盖当前的点位路由信息。**
>* **导入时会根据点位id来进行逐一匹配。如果文件中点位id在页面中的点位中并不存在，则会进行忽略；如果文件中有重复的点位映射信息，那么会使用较后面的点位映射信息。**

###### 手动修改点位映射

![39](.\docs\public\images\Setting\Configuration\channel\39.png)

1. 点击所要修改的点位的**修改图**标按钮对点位进行修改。
2. 依照点位的配置规则，对点位进行修改，对已有点位进行修改的时候，不可以修改id。
3. 点击**确认图标**按钮，本地保存对点位的修改。
4. 点击**取消图标**按钮，取消本次对点位的修改。
5. 本地修改后的点位记录样式如图所示，其会把修改的数据使用蓝色进行标记。可以通过“modified”筛选条件进行筛选。

###### 提交所有修改

![40](.\docs\public\images\Setting\Configuration\channel\40.png)

1. 在提交时必须保证修改的点位映射数据没有问题，错误提示会出现在错误数据下方。
2. 点击**Submit**按钮进行批量修改提交。
3. 点击**Cancel Edit**按钮，退出修改，点位表展示初始值。
    注意：无需手动进行查询，直接点击**Submit**按钮之后，若有问题可以直接进行跳转。

##### 导出点位映射CSV文件

![41](.\docs\public\images\Setting\Configuration\channel\41.png)

1. 点击**Export**按钮，可以实现对当前点位类型下面的表格数据进行导出，导出格式为**.csv**，文件名称为：**通道的名称 + tab名称（telemetry/signal/control/adjustment） + "_mapping" + 当前时间戳**。

## 设备实例以及实例点位配置

![1](.\docs\public\images\Setting\Configuration\deviceInstance\1.png)

### 基础概念

在微电网 EMS 中，为了标准化设备接入与点位管理，引入了产品、实例、实例点位与点位路由（映射）等基础概念：产品定义一类设备的标准能力与点位模型；实例是产品在现场的一台具体设备对象；实例点位用于表达该设备的配置与运行数据，按用途分为 **property（属性）/ measurement（测量）/ action（动作）**；实例映射（路由）则把实例点位绑定到现场通道点（并区分四遥类型 T/S/C/A），从而实现测量数据上送与控制/调节指令下发的准确对接。
#### 产品
##### 概念定义 

产品是平台对一类设备/系统的标准化模型，用于抽象该类对象在 EMS 中应具备的能力与数据接口。产品不代表现场某台具体设备，而代表同一类型设备的共性结构与标准接口，它描述这类设备在平台里应该长什么样、有哪些能力：

- 有哪些点位（属性点位、测量点位、动作点位）
- 每个点位代表什么含义（例如：SOC、功率、告警、启停、功率设定等）
产品不是现场的某一台设备，而是“同类设备通用的定义”。
本平台中提供以下产品：
- **battery_cell（电芯）**
  - 定义：电池系统最小电化学单元。
  - 作用：提供最底层的电压/温度等基础数据来源，是 BMS 精细化监测与安全评估的基础。
- **battery_module（电池模组）**
  - 定义：由多个电芯组成的结构与电气组合单元。
  - 作用：汇聚电芯级数据，常用于模组电压、温度分布、均衡/保护等管理与展示。
- **battery_cluster（电池簇/电池组）**
  - 定义：由多个电池模组组成的更高一级聚合单元（也常对应“一个簇 BMS”管理范围）。
  - 作用：提供簇级 SOC/SOH、簇电压/电流、簇告警等关键运行视图，便于 EMS 做策略与安全联动。
- **battery_stack（电池堆/电池串列）**
  - 定义：由多个电池簇组成的系统级串并联组合单元（工程上常对应一个电池堆）。
  - 作用：提供系统级直流侧关键量（总电压/总电流/总功率等）及堆级告警，用于与 PCS/直流变换环节联动。
- **battery_pack（电池包/电池系统包）**
  - 定义：电池侧在 EMS 里更偏“资产/系统”的抽象对象（通常用于汇总一个储能电池系统的整体能力）。
  - 作用：用于容量、额定参数、运行统计、告警汇总、报表与资产管理；常作为 BESS 电池侧的顶层对象。
- **dc_dc_converter（DC/DC 变换器）**
  - 定义：直流-直流功率变换设备（升压/降压/隔离等）。
  - 作用：实现不同直流母线电压等级的匹配、能量调节与保护协同；常用于电池侧/直流母线侧的功率控制链路。
- **pcs（储能变流器 / Power Conversion System）**
  - 定义：储能系统核心功率变换设备（DC↔AC）。
  - 作用：执行充放电功率控制、并网/离网运行、无功支撑、电能质量控制等；是 EMS 策略下发与执行的关键对象。
- **diesel_generator（柴油发电机）**
  - 定义：可控的备用/应急/调峰电源。
  - 作用：在离网或电网薄弱场景提供稳定电源；支持启停控制、功率调节、运行状态与故障监测。
- **motor（电机）**
  - 定义：电机类负载/设备（可作为动力设备或关键工艺设备抽象）。
  - 作用：用于监测运行状态、功率/电流等；部分场景可做启停/调速控制（取决于现场控制系统与接入点位）。
- **load（负荷）**
  - 定义：用电侧的汇总对象或可控负荷对象（如园区负荷、楼宇负荷、产线负荷等）。
  - 作用：作为 EMS 负荷预测、能量平衡、削峰填谷与需求响应的核心输入；可扩展为可控负荷时支持策略联动。
- **pv_string（光伏组串）**
  - 定义：组件串联形成的发电单元。
  - 作用：组串级电压/电流/功率监测，便于定位遮挡、失配、衰减等问题（视接入能力而定）。
- **pv_optimizer（优化器）**
  - 定义：组件/组串级的功率优化与监测装置。
  - 作用：提升发电效率、支持更细粒度监测与故障定位；通常与组串/组件级数据关联。
- **pv_combiner（汇流箱）**
  - 定义：多路组串并联汇流到直流母线的设备。
  - 作用：汇总组串回路、提供支路电流/开关/防雷等监测与保护信息，是组串到逆变器之间的关键节点。
- **pv_inverter（光伏逆变器）**
  - 定义：将光伏直流电转换为交流并网/供电的设备。
  - 作用：输出功率控制、并网运行管理、无功/电能质量支撑、状态告警监测；是 EMS 光伏侧主要被控/被监测对象。
- **gateway（网关）**
  - 定义：连接现场设备与云端/平台的采集与协议转换节点。
  - 作用：承载通道与协议、完成数据采集上送与指令下发；负责点位映射、缓存、边缘计算/转发等（按实现能力）。
- **station（站点/场站）**
  - 定义：微电网/场站的顶层组织对象（一个项目或一个站）。
  - 作用：承载该站的设备树、拓扑与汇总指标（如站级功率/能量/告警），用于权限、报表、调度策略与运维管理的统一入口。

##### 作用

- 统一同类设备的点位集合与语义（标准化）
- 支持批量实例化（同一产品可创建多个设备实例）
- 便于系统接入、运维、配置复用

#### 实例
##### 概念定义

实例是产品模型在现场工程中的具体对象化表达（Asset/Device Instance），对应实际存在的一台设备、一个系统单元或一个逻辑对象（如 PCS_01、BESS_01、PCC_METER_01）。实例具有唯一标识 instance_id，并绑定一个 product_name，继承该产品的点位体系。
实例不仅是展示层的“设备条目”，更是平台进行状态计算、控制下发、告警定位等行为的最小业务承载单元。

##### 字段解释

* `insance_id`：实例的id，是唯一的标识符。
* `instance_name`：实例的名称。
* `product_name`：实例所属的产品名称。
* `properties`：实例自身的属性。

##### 作用

- 将“模板（产品）”落到“现场对象（实例）”
- 实例承载产品设备的配置属性（properties）与运行点位（measurement/action）
- 与现场通道（四遥）建立映射，实现数据采集与控制下发

#### 实例点位
##### 概念定义

实例点位是实例在平台中的“数据接口”，用于表达该实例可被配置、可被观测、可被控制的所有信息。
实例点位分为以下三类：

- **property 点位**
  用于描述设备“静态/半静态配置参数”，例如：额定功率、容量、通信地址、控制策略参数、告警阈值等。
  作用：
  - 作为实例的配置数据来源
  - 用于策略计算、限值校验、展示与运维配置
  - 通常不高频变化（可由人工配置/策略写入）
- **measurement 点位**
  表示设备“可被采集的状态/遥测/遥信”数据，如电压、电流、功率、SOC、开关状态、告警状态等。
  作用：
  - 实时监测与可视化
  - 告警、联动、报表、优化调度的输入数据
- **action 点位**
  表示“可下发控制/调节”的点位，如启动/停机、合闸/分闸、有功/无功设定、充放电功率设定、模式切换等。
  作用：
  - EMS 控制闭环输出（策略/人工操作 → 下发到设备）
  - 支持控制（Control）与调节（Adjustment）两类指令

##### 字段解释

* `point_id`：点位在其所在的点位分类中的唯一标识。
* `name`：点位名称。
* `value`：当前点位的值。
* `unit`：点位的单位。
* `description`：点位的备注信息。

##### 作用

- 统一语义与数据治理。将不同协议、不同厂家的原始点号统一映射为一致的语义点位，便于上层应用理解与复用。
- 作为监控与告警的基础颗粒度。趋势曲线、阈值告警、事件联动、报表统计都以点位为基本对象。
- 作为控制闭环的输入/输出接口，策略读取 **measurement** 点位形成状态判断，向 **action** 点位写入目标值触发下发。

#### 实例点位路由
##### 概念定义

实例点位映射就是把平台里的“实例点位”绑定到现场的“通道点位/点号”的配置关系，它回答一个关键问题：
**这个实例的这个点位，对应现场哪条通道、哪个点号？属于四遥中的哪一类？**

* 对于 **measurement** 点位，其对应的通道点位的类型只能是 **Telemetry** 和 **Signal**。
* 对于 **action** 点位，其对应的通道点位的类型只能是 **Control** 和 **Adjustment**。
* **property** 点位作为固有属性，没有路由信息。

##### 字段解释

* `point_id`：对应实例点位的id。
* `name`：对应点位的名称。
* `channel_id`：点位对应路由的通道的id。
* `channel_type`：点位对应路由的通道的四遥类型。
* `channel_point_id`：点位对应路由的通道点位id。

##### 作用

- 数据上行（采集）。通道采到的数据按映射路由到对应的 measurement 点位。
- 指令下行（控制）。对 action 点位写入的值按映射路由到对应的通道点号下发给设备。
- 解耦业务与协议。业务侧只关心点位语义；通信侧只关心地址点号；映射把两者连接起来，便于换协议/换网关/改点表。

### 配置操作

#### 查询设备实例

![2](.\docs\public\images\Setting\Configuration\deviceInstance\2.png)

1. 支持对实例进行筛选。筛选条件有：
- `Product_Name`：实例所属的产品名称。
2. 点击**Search**按钮，进行筛选搜索。
3. 点击**Reload**按钮，进行搜索重置。

#### 新增设备实例

![3](.\docs\public\images\Setting\Configuration\deviceInstance\3.png)

![4](.\docs\public\images\Setting\Configuration\deviceInstance\4.png)

1. 点击New Instance按钮，打开新增实例弹框。

2. 填入正确的参数，字段详情参考基础概念实例的字段介绍。
3. 点击属性添加图标按钮，可以添加一条属性值。
4. 点击属性删除图标按钮，可以删除对应的属性值。
5. 点击Submit按钮，提交新增的实例。
6. 点击Cancel按钮，取消新增。

#### 查看设备实例详情

![5](.\docs\public\images\Setting\Configuration\deviceInstance\5.png)

![6](.\docs\public\images\Setting\Configuration\deviceInstance\6.png)

1. 点击所要查看的实例Operation列中的Detail按钮，打开实例详情弹框。

#### 编辑设备实例

![7](.\docs\public\images\Setting\Configuration\deviceInstance\7.png)

![8](.\docs\public\images\Setting\Configuration\deviceInstance\8.png)

1. 在查看实例详情的弹框中，点击**Edit**按钮进入实例信息的编辑模式。

2. 在修改中，除去`Product Name`无法进行修改，其余修改与新增中一致。
3. 点击**Submit**按钮进行修改提交。
4. 点击**Cancel Edit**按钮取消编辑。

#### 删除已有的设备实例

![9](.\docs\public\images\common\9.png)



![10](.\docs\public\images\Setting\Configuration\deviceInstance\10.png)

1. 点击想要删除的设备实例行中**Operation**列的**Delete**按钮进行删除。

2. 点击**Confirm**按钮确认删除。
3. 点击Cancel按钮取消删除。

#### 设备实例点位配置

![11](.\docs\public\images\Setting\Configuration\deviceInstance\11.png)

![12](.\docs\public\images\Setting\Configuration\deviceInstance\12.png)

1. 通过点击想要查看的设备实例行**Operation**列的**Points**按钮，打开点位弹框。

2. **View Mode** 选框用于切换视图，视图分为点位视图和点位路由视图，点击按钮进行切换（默认为点位视图）。
3. 用于切换表格中展示的点位类型的标签按钮，在点位视图中有三个标签：**Property**、**measurement**、**action**。
4. 点位筛选框，可以手动输入进行点位名称的模糊搜索或者通过下拉框对点位名称的选择进行精准搜索。
5. **Export**按钮，用于把当前点位类型表格数据以csv的格式进行导出。
6. **Execute**按钮，用于执行下发点位值。
7. **Cancel**按钮，用于关闭弹框。

##### 点位命令下发

![13](.\docs\public\images\Setting\Configuration\deviceInstance\13.png)

![14](.\docs\public\images\Setting\Configuration\deviceInstance\14.png)

![15](.\docs\public\images\Setting\Configuration\deviceInstance\15.png)

2. 点击所要执行某一数值的点位所在行**Operation**列的**Execute**按钮，打开执行弹框。
3. 输入要执行的值（数字）。
4. 点击**Submit**按钮进行提交。
5. 点击**Cancel**按钮取消提交。
6. 提交成功后值发生变化。

##### 导出点位CSV文件

![16](.\docs\public\images\Setting\Configuration\deviceInstance\16.png)

1. 点击**Export**按钮，将当前显示的表格数据进行导出，导出的**.csv文件**的文件名格式为：**实例名称_点位类型（property/measurement/action）_points_当前时间戳.csv**，文件如下图所示：

![17](.\docs\public\images\Setting\Configuration\deviceInstance\17.png)

#### 设备实例点位路由配置
![18](.\docs\public\images\Setting\Configuration\deviceInstance\18.png)

1. 通过点击**view Mode**中的**Routing**进行视图切换，打开实例点位路由视图。

2. **Edit**按钮，点击以进入点位路由的修改模式。

  > 注意：property点位是产品的固有属性，不需要通过路由与通道点位相通，因此在点位路由中只有measurement类型和action类型。

#### 导出点位路由CSV文件
![19](.\docs\public\images\Setting\Configuration\deviceInstance\19.png)

2. 点击**Export**按钮，将当前显示的表格数据进行导出，导出的csv文件的文件名格式为：**实例名称_点位类型（measurement/action）_routing_当前时间戳.csv**，文件如下图所示：
    ![20](.\docs\public\images\Setting\Configuration\deviceInstance\20.png)
    在导出文件中，**point_type**以缩写的形式展示，其对应规则为：**T对应Telemetry，S对应Signal，C对应Control，A对应Adjustment。**

##### 批量修改实例点位路由
![21](.\docs\public\images\Setting\Configuration\deviceInstance\21.png)

![22](.\docs\public\images\Setting\Configuration\deviceInstance\22.png)

1. 点击**Edit**按钮，进入点位路由的编辑模式。

2. 针对修改过程中的修改操作，可以通过筛选条件进行筛选：

- **modified**：对进行了实际修改的点位进行筛选，修改后的点位记录左侧显示为蓝色，修改后的数据标为蓝色。
![23](.\docs\public\images\Setting\Configuration\deviceInstance\23.png)
- **invalid**：对通过增加、修改后存在问题的点位进行筛选，存在问题的点位记录的左侧显示为橙色，背景显示为暗红色。
![24](.\docs\public\images\Setting\Configuration\deviceInstance\24.png)

> 点位路由配置规则：
>
> * Channel为设备实例点位路由映射的通道点位所在的通道。
> * Channel Point Type为设备实例点位路由映射的通道点位所属的四遥类型，按照通道所遵循协议的不同，其可选值也不同：
>   * 对于遵循modbus_rtu和modbus_tcp协议的通道。其中对于measurement类型的设备实例点位，Channel Point Type只能是Telemetry和Signal，对于action类型的设备实例点位，Channel Point Type只能是Control和Adjustment。
>   * 对于遵循di_do协议的通道。其中对于measurement类型的设备实例点位，Channel Point Type只能是Signal，对于action类型的设备实例点位，Channel Point Type只能是Control。
> * Channel Point为设备实例点位路由映射的通道点位。
> * 三个选项的具有先后顺序，需按照Channel->Channel Point Type->Channel Point的顺序进行选择。 

###### 手动修改点位路由信息
![25](.\docs\public\images\Setting\Configuration\deviceInstance\25.png)

1. 点击所要修改的点位路由的**修改图标**按钮对点位进行修改。
2. 依照点位路由的配置规则，对点位路由进行修改，对已有点位进行修改的时候，不可以修改id。
3. 点击**确认图标**按钮，本地保存对点位路由的修改。
4. 点击**取消图标**按钮，取消本次本地对点位路由的修改。
5. 本地修改后的点位路由记录样式如图所示，其会把修改的数据使用蓝色进行标记。可以通过“**modified**”筛选条件进行筛选。

###### 通过文件导入点位路由信息
![26](.\docs\public\images\Setting\Configuration\deviceInstance\26.png)

1. 点击**Import**按钮，选择**.csv格式**的点位文件进行导入，对文件的内容有以下要求：

- 期望表头**(必须包含以下表头信息，其他额外表头也可以存在，但是并不会起作用)**：
  `point_id,channel_id,channel_point_type,channel_point_id,enabled`
  在导入后，会根据**point_id**进行点位与路由信息的匹配。
  
- 字段说明：
  - `point_id`为实例点位的id，如果点位不存在，则这条点位路由信息无效。
  - `point_name`为实例点位的名称。
  - `channel_id` 为路由映射的通道点位所属通道的id，如果该通道并不存在，则对应的通道点位也视为不存在，会进行错误提示。
  - `channel_point_type`为路由映射的通道点位所属的点位类型（四遥：T/S/C/A），**其接受四遥的缩写：T、S、C、A，也接受四遥的全称：Telemetry、Signal、Control、Adjustment（注意要严格遵循字母的大小写要求）**。
  - `channel_point_id`为路由映射的通道点位id，如果该点位不存在，则会进行错误提示。
  - `enabled`为该点位映射是否可用的标识，接受**false**和**true**两个值。
  
- 格式截图：

  <img src=".\docs\public\images\Setting\Configuration\deviceInstance\27.png" alt="27" style="zoom:50%;" />

> 注意：
>
> * 通过文件导入的形式进行实例点位路由修改的时候，其会整体覆盖当前的点位路由信息。
>
> * 导入时会根据点位id来进行逐一匹配。如果文件中点位id在页面中的点位中并不存在，则会进行忽略；如果文件中有重复的点位路由信息，那么会使用较后面的点位路由信息。

###### 提交所有的修改
![28](.\docs\public\images\Setting\Configuration\deviceInstance\28.png)

1. 在提交时必须保证修改的点位数据没有问题，错误提示会出现在错误数据下方。
2. 点击**Submit**按钮进行批量修改提交。
3. 点击**Cancel Edit**按钮，退出修改，点位表展示初始值。
    注意：无需手动进行查询，直接点击**Submit**按钮之后，若有问题可以直接进行跳转。

## 规则配置
![29](.\docs\public\images\Setting\Configuration\deviceInstance\29.png)

### 基础概念

在 EMS 系统中，电池、PCS、光伏、柴油机等设备之间需要在不断变化的工况下协同运行，系统需要根据实时测量数据做出判断，并及时下发控制指令或调整运行参数（例如功率设定、启停、模式切换等），以实现安全稳定与经济优化的目标。为实现策略的标准化配置与可视化管理，平台引入了**规则（Rule）与规则链路（Rule Flow）**等概念。
#### 规则
##### 概念定义
 规则是 EMS 中用于表达“运行策略”的基本单元，用来描述系统在特定工况下应采取的控制逻辑。它把实时数据（测量值/状态量/计算结果）作为输入，通过条件判断确定当前场景，并输出对应的控制动作或参数调整结果。
##### 作用

- 策略固化与自动化执行：把人工经验/调度策略配置成系统可自动执行的逻辑，实现无人值守的策略运行。
- 运行目标落地：围绕安全、稳定、经济、效率等目标，在不同工况下自动选择合适的控制措施。
- 统一管理与复用：规则可集中管理（启用/停用、优先级等），便于在不同站点或项目中复用与迁移。

#### 规则链路

##### 概念定义

 规则链路是规则内部的可视化执行流程，用“节点 + 连线”的方式描述规则从开始到结束的完整执行路径。它将规则拆分为多个步骤（如开始、条件判断、动作执行、结束），并通过分支结构表达不同条件下的不同处理路径。
##### 作用

- 清晰表达复杂逻辑：把多条件、多分支、多动作的策略以流程图方式呈现，降低理解和配置成本。
- 可追踪与可诊断：运行时可定位实际执行路径与关键节点数据，帮助快速排查“为何这样执行”。
- 易维护与易迭代：通过图形化结构快速调整策略步骤与分支关系，支持版本化管理以及导入/导出复用。

### 配置操作
#### 新增规则

![2](.\docs\public\images\Setting\Configuration\rule\2.png)

![3](.\docs\public\images\Setting\Configuration\rule\3.png)

1. 点击**New Rule**按钮，打开新增规则弹窗。
2. 输入规则的名称（必填）和描述信息（选填）。
3. 点击**Submit**按钮进行新增规则的提交。
4. 点击**Cancel**按钮取消新增操作，关闭弹窗。

#### 修改规则

![4](.\docs\public\images\Setting\Configuration\rule\4.png)

![5](.\docs\public\images\Setting\Configuration\rule\5.png)

1. 点击想要修改的规则行中**Operation**列的**Edit**按钮，打开编辑弹框。
2. 对想要修改的规则名称以及描述信息进行修改。
3. 点击**Submit**按钮对编辑的信息进行提交。
4. 点击**Cancel**按钮取消对编辑信息的提交，并且关闭弹窗。

#### 删除规则

![6](.\docs\public\images\Setting\Configuration\rule\6.png)

![7](.\docs\public\images\Setting\Configuration\rule\7.png)

1. 点击想要删除的规则行的**Operation**列的**Delete**按钮打开确认删除的提示弹框。
2. 点击**Confirm**按钮确认删除。
3. 点击**Cancel**按钮取消删除。

#### 查看规则链路详情及实时执行链路

![8](.\docs\public\images\Setting\Configuration\rule\8.png)

![9](.\docs\public\images\Setting\Configuration\rule\9.png)

![10](.\docs\public\images\Setting\Configuration\rule\10.png)

1. 点击所要查看规则行的**Operation**列的**Detail**按钮，挑战到规则链详情页面。

2. 规则链路中高亮的路径为当前规则所执行的路径，当前所执行的路径的节点的具体数据会显示节点的下方位置。

3. 点击**Edit**按钮，进入规则链编辑状态。

4. 点击**Export**按钮对当前规则链进行导出，导出文件的格式为**.json文件**，具体内容结构如下：

  ```
  {
    "cooldown_ms": 5000, //循环间隔
    "description": "Control the diesel generators and photovoltaic systems based on the values of SOC.",//规则链描述
    "enabled": true,//是否可用
    "flow_json": {//用于记录点位以及线段的信息
   "edges": [//所有线段的信息
     {
       "id": "edge-1766625864321",//线段id
       "source": "start",//线段起点节点
       "target": "node-1766625792260",//线段结束节点
       "sourceHandle": "right",//线段起点节点的输出点位id
       "targetHandle": "left"//线段终点节点的接受点位id
     },
     {
       "id": "edge-1766627137707",
       "source": "node-1766625792260",
       "target": "node-1766627111063",
       "sourceHandle": "out001",
       "targetHandle": "left"
     },
     {
       "id": "edge-1766627164179",
       "source": "node-1766627111063",
       "target": "end",
       "sourceHandle": "right1",
       "targetHandle": "left"
     },
     {
       "id": "edge-1766627167317",
       "source": "node-1766627120005",
       "target": "end",
       "sourceHandle": "right1",
       "targetHandle": "left"
     },
     {
       "id": "edge-1766627188300",
       "source": "node-1766627123081",
       "target": "end",
       "sourceHandle": "right1",
       "targetHandle": "left"
     },
     {
       "id": "edge-1766970657249",
       "source": "node-1766625792260",
       "target": "node-1766627120005",
       "sourceHandle": "out002",
       "targetHandle": "left"
     },
     {
       "id": "edge-1766970658549",
       "source": "node-1766625792260",
       "target": "node-1766627123081",
       "sourceHandle": "out003",
       "targetHandle": "left"
     }
   ],
   "nodes": [//所有节点的信息
     {
       "id": "start",//节点的id
       "type": "start",//起始节点
       "position": {//画布中的位置
         "x": -213,//x轴坐标
         "y": 107//y轴坐标
       },
       "data": {//内部数据
         "config": {//点位配置
           "wires": {//输出点位以及其对应的节点id（除特殊类型点位以外其余默认为default点位）
             "default": [
               "node-1766625792260"
             ]
           }
         },
         "description": "START",//节点描述信息
         "id": "start",//节点id
         "label": "START",//节点的标题
         "status": "",//节点状态，保留
         "type": "start"//节点类型
       }
     },
     {
       "id": "end",
       "type": "end",//结束点位
       "position": {
         "x": 629,
         "y": 101
       },
       "data": {
         "config": {
           "wires": {
             "default": []
           }
         },
         "description": "END",
         "id": "end",
         "label": "END",
         "status": "",
         "type": "end"
       }
     },
     {
       "id": "node-1766625792260",
       "type": "custom",//自定义的节点类型
       "position": {
         "x": 25,
         "y": 106
       },
       "data": {
         "cardId": "function-2",
         "config": {//该节点为function-switch类型的节点，主要用来条件判断
           "rule": [//记录输出点位以及具体规则判断
             {
               "name": "out001",//输出点位的名称，与wires中的输出点位对应
               "rule": [//具体的规则
                 {
                   "operator": "<=",//操作符
                   "type": "variable",//记录的类型参数，此时只有一条规则
                   "value": 5,//数值
                   "variables": "X1"//比较的值的名称，与variables中所给予的名称相同
                 }
               ],
               "type": "default"//保留字段
             },
             {
               "name": "out002",
               "type": "default",
               "rule": [
                 {
                   "type": "variable",
                   "variables": "X1",
                   "operator": ">=",
                   "value": 49
                 },
                 {
                   "type": "relation",//记录的类型参数，为relation说明这是一个连接符号，以此处理多个判断规则
                   "value": "And"//连接的符号为And
                 },
                 {
                   "type": "variable",
                   "variables": "X1",
                   "value": 99,
                   "operator": "<"
                 }
               ]
             },
             {
               "name": "out003",
               "type": "default",
               "rule": [
                 {
                   "type": "variable",
                   "variables": "X1",
                   "operator": ">",
                   "value": 99
                 }
               ]
             }
           ],
           "variables": [//所需要参数定义
             {
               "instance_id": 1,//点位所属实例的id
               "instance_name": "battery_01",//点位所属实例的名称
               "name": "X1",//默认给予名称，用于在节点规则中配置，规则为"X+num"
               "pointType": "measurement",//点位的类型
               "point_name": "SOC",//点位的名称
               "type": "single",//参数定义的类型，分为single和combined
               "unit": "%",//点位的单位
               "point_id": 3,//点位的id
               "formula": []//当参数定义类型为combined的时候，记录组合类参数定义的形式
             }
           ],
           "wires": {//对于“function-switch”功能卡片，其会有多个接口，此处记录了每个输出节点所对应的下一个点位的id。
             "out001": [
               "node-1766627111063"
             ],
             "out002": [
               "node-1766627120005"
             ],
             "out003": [
               "node-1766627123081"
             ]
           }
         },
         "description": "Switch function",
         "id": "node-1766625792260",
         "label": "Switch Function",
         "type": "function-switch",
         "status": ""
       }
     },
     {
       "id": "node-1766627111063",
       "type": "custom",
       "position": {
         "x": 300,
         "y": -5
       },
       "data": {
         "cardId": "action-1",
         "config": {
           "rule": [//规则配置
             {
               "Variables": "X1",//定义的参数值
               "value": 42290//赋予的值（如果是数字则是具体的数值，如果是字符串，则赋予对应参数的值）
             },
             {
               "Variables": "X2",
               "value": 999
             }
           ],
           "variables": [
             {
               "formula": [],
               "instance_id": 2,
               "instance_name": "diesel_gen_01",
               "name": "X1",
               "pointType": "action",
               "point_id": 1,
               "point_name": "Start Inverter",
               "type": "single",
               "unit": ""
             },
             {
               "name": "X2",
               "type": "single",
               "instance_id": 4,
               "instance_name": "pv_01",
               "pointType": "action",
               "point_id": 5,
               "point_name": "Power Setpoint",
               "unit": "kW",
               "formula": []
             }
           ],
           "wires": {
             "default": [
               "end"
             ]
           }
         },
         "description": "The SOC is too low.",
         "id": "node-1766627111063",
         "label": "SOC low",
         "type": "action-changeValue",//该类型的节点可以用来执行某些action或者修改点位的值。
         "status": ""
       }
     },
     {
       "id": "node-1766627120005",
       "type": "custom",
       "position": {
         "x": 302,
         "y": 101
       },
       "data": {
         "cardId": "action-1",
         "config": {
           "rule": [
             {
               "Variables": "X1",
               "value": 42289
             },
             {
               "Variables": "X2",
               "value": 999
             }
           ],
           "variables": [
             {
               "name": "X1",
               "type": "single",
               "instance_id": 2,
               "instance_name": "diesel_gen_01",
               "pointType": "action",
               "point_id": 1,
               "point_name": "Start Inverter",
               "unit": "",
               "formula": []
             },
             {
               "name": "X2",
               "type": "single",
               "instance_id": 4,
               "instance_name": "pv_01",
               "pointType": "action",
               "point_id": 5,
               "point_name": "Power Setpoint",
               "unit": "kW",
               "formula": []
             }
           ],
           "wires": {
             "default": [
               "end"
             ]
           }
         },
         "description": "The SOC is normal.",
         "id": "node-1766627120005",
         "label": "SOC normal",
         "type": "action-changeValue",
         "status": ""
       }
     },
     {
       "id": "node-1766627123081",
       "type": "custom",
       "position": {
         "x": 297,
         "y": 219
       },
       "data": {
         "cardId": "action-1",
         "config": {
           "rule": [
             {
               "Variables": "X1",
               "value": "X2"
             }
           ],
           "variables": [
             {
               "name": "X1",
               "type": "single",
               "instance_id": 4,
               "instance_name": "pv_01",
               "pointType": "action",
               "point_id": 5,
               "point_name": "Power Setpoint",
               "unit": "kW",
               "formula": []
             },
             {
               "name": "X2",
               "type": "single",
               "instance_id": 3,
               "instance_name": "pcs_01",
               "pointType": "measurement",
               "point_id": 2,
               "point_name": "DC Power",
               "unit": "kW",
               "formula": []
             }
           ],
           "wires": {
             "default": [
               "end"
             ]
           }
         },
         "description": "The SOC is too high.",
         "id": "node-1766627123081",
         "label": "SOC high",
         "type": "action-changeValue",
         "status": ""
       }
     }
   ]
    },
    "format": "vue-flow",
    "id": "1",//规则id
    "name": "SOC Monitoring",//规则名称
    "priority": 10//优先级
  }
  ```

5. 点击**FullScreen**按钮，进入全屏模式。

6. 点击**Exit Fullscreen**按钮，退出全屏模式。

##### 修改规则链路

![11](.\docs\public\images\Setting\Configuration\rule\11.png)

![12](.\docs\public\images\Setting\Configuration\rule\12.png)

1. 点击**Edit**按钮进行到规则链的编辑模式。

2. 此处为自定义的功能卡片，可以使用鼠标点击所需要的卡片进行拖拽，从而放置到规则链的画布中。不同的卡片具有不同的功能：

     - **Switch Function——数值判断卡片**
       ![13](.\docs\public\images\Setting\Configuration\rule\13.png)
       该卡片主要用于对实例的点位数据的值是否满足某一条件进行判断。
     - **Change Value——数据修改卡片**
       ![14](.\docs\public\images\Setting\Configuration\rule\14.png)
       该卡片主要用来修改某一实例的点位数据。

3. 此处为规则链的画布，可以在此处进行卡片的配置、连线。基础操作如下：

     - 画布中必须要有**Start**卡片和**End**卡片的存在，**规则链必须从Start卡片开始，以End卡片结束**。
     - 卡片的左侧的点位为输入点位，只能作为连线的终点；卡片的右侧的点位为输出点位，只能作为连线的起点。
     - 需要进行删除操作的时候，单击卡片或者线段，再点击键盘中的”Backspace“键进行删除**（start卡片和end卡片是不能够删除的）**。
     - 双击卡片进行卡片内部的参数配置，不同的卡片类型所编辑的数据不同：
       - **Switch Function——数值判断卡片**
         ![15](.\docs\public\images\Setting\Configuration\rule\15.png)
       
         1. 第一部分为基础信息区域，主要是卡片展示的信息：**label**为卡片的标题信息，**description**为卡片的描述信息。
         2. 第二部分为参数定义区域，在此处进行参数的声明：
             ![16](.\docs\public\images\Setting\Configuration\rule\16.png)
             点击添加按钮，可以进行参数定义的新增，每个参数给予的名称为**X+自增序列号**。
             点击每个参数对应的删除图标按钮，可以删除该的参数。
             参数声明有两种类型：**single**和**combined**类型，其规则如下：

           * **single**类型为单一参数定义。用户只需要依次选择实例名称、点位类型、点位名称即可。
             ![17](.\docs\public\images\Setting\Configuration\rule\17.png)
       
           * **combined**类型为组合式参数定义。用户可以选择已经定义的参数或者手动输入数字进行组合式计算，支持选择运算符：`+、-、*、/`。用户点击下方的**绿色新增图标**按钮可以增加一行数据运算参数，点击对应运算数据右侧的**红色删除图标**按钮，可以删除这一行数据。
             ![18](.\docs\public\images\Setting\Configuration\rule\18.png)
         3. 第三部分判断规则定义区域，在此处进行规则的声明：
             ![19](.\docs\public\images\Setting\Configuration\rule\19.png)
             点击**橙色新增图标**按钮新增规则，每次新增的规则的给予的名称为**out+自增列号**。
             点击每个规则对应的**删除图标**按钮删除该规则。
             ![20](.\docs\public\images\Setting\Configuration\rule\20.png)
             根据在参数定义中的参数名称，用户在此处可以选择已经定义的参数与其他参数或者数值进行比较。用户可以点击绿色新增按钮，添加额外一行规则判断，并进行组合式判断（目前两个判断之间只允许And判断，及两者都满足)，用户可以点击对应规则后面的红色删除按钮，对这一行规则判断进行删除。

           > 注意：每一个完整的**out+xxx**的规则都会在节点卡片上生成一个对应的点位，只有满足判断条件的时候，才会执行这个点位连通的下一节点。
           > ![21](.\docs\public\images\Setting\Configuration\rule\21.png)
       - **Change Value——数据修改卡片**
         ![22](.\docs\public\images\Setting\Configuration\rule\22.png)
         
         1. 第一部分为基础信息区域，主要是卡片展示的信息：**label**为卡片的标题信息，**description**为卡片的描述信息。
         2. 第二部分为参数定义区域，在此处进行参数的声明，其声明方式同**Switch Function**中的声明方式。
         3. 第三部分为修改规则定义区域，在此处进行实例点位参数的修改。
             ![23](.\docs\public\images\Setting\Configuration\rule\23.png)
             点击**橙色新增图标**按钮，新增参数修改规则。
             点击每个修改规则对应的**删除图标**按钮，删除该规则。
             对于参数的设置分为左右两个参数。整体逻辑是要把左侧的参数修改为右侧的数值或者参数。左侧的选择框只能选择**single**类型的参数；右侧的选择框可以选择任意已经定义的参数或者自定义数值。
4. 画布控件，从上到下依次为：放大画布按钮、缩小画布按钮、规则链自适应画布大小按钮、禁止/允许画布操作按钮。
5. 规则链保存按钮。当进行点位/线段的增加、修改、删除操作时才允许进行保存。
6. 规则链取消按钮。当进行点位/线段的增加、修改、删除操作时才允许进行取消，其会将规则链恢复到未保存之前的样子。
7. **Fullscreen**按钮，点击打开全屏编辑状态。
8. **Import**按钮，点击后可以选择.json文件进行规则链的导入操作，**对.json文件的格式要求同导出的.json文件格式**。
9. **Cancel Edit**按钮，点击后退出编辑状态。